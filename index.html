<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org"></script>
    <script>
        var tg = window.Telegram.WebApp;
        tg.expand();

        // Глобальная переменная
        var score = 0;

        // ФУНКЦИЯ ЗАГРУЗКИ (Твоя первостепенная задача)
        function initGame() {
            // 1. Проверяем, есть ли уже число в URL
            var query = window.location.search.substring(1).replace(/[^0-9]/g, '');
            
            if (query === "" || isNaN(parseInt(query))) {
                // Если там пусто или NaN — ПРИНУДИТЕЛЬНО ставим 8
                score = 8;
                var newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?' + score;
                window.history.replaceState({path:newUrl}, '', newUrl);
            } else {
                // Если число уже есть (например после клика) — берем его
                score = parseInt(query);
            }
            
            render();
        }

        function play() {
            score = score - 1; // Убавляем единичку
            
            // Сразу синхронизируем URL
            var newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?' + score;
            window.history.replaceState({path:newUrl}, '', newUrl);
            
            render();
        }

        function render() {
            // Рисуем число на экране
            document.getElementById('sc').textContent = "Score: " + score;
            tg.MainButton.setText("СОХРАНИТЬ " + score).show();
        }

        tg.onEvent('mainButtonClicked', function() {
            tg.sendData(score.toString());
        });
    </script>
</head>
<body onload="initGame()" style="text-align:center; background:#2c3e50; color:white; font-family:sans-serif; padding-top:50px;">
    
    <div style="background:#34495e; padding:20px; border-radius:20px; display:inline-block; border: 3px solid #e74c3c;">
        <h1 id="sc" style="font-size:40px; margin:0;">Score: ?</h1>
    </div>

    <div style="margin-top:30px;">
        <button onclick="play()" style="width:200px; height:200px; border-radius:50%; border:none; background:#e74c3c; color:white; font-size:30px; font-weight:bold; box-shadow: 0 10px #c0392b; cursor:pointer; active: transform:translateY(5px); outline:none;">
            КЛИК!
        </button>
    </div>

    <p style="margin-top:40px; opacity:0.5;">Первостепенная задача: <br>Принудительная 8 в URL</p>

</body>
</html>
