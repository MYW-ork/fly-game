<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <script>
        var tg = window.Telegram.WebApp;
        tg.expand();

        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        var score = 0;

        function initGame() {
            // –ò—â–µ–º s= –≤ URL
            var urlStr = window.location.search;
            var match = urlStr.match(/s=(\d+)/); 
            
            if (match && match[1]) {
                score = parseInt(match[1]);
            } else {
                score = 8; // –î–µ—Ñ–æ–ª—Ç, –µ—Å–ª–∏ –±–æ—Ç –ø—Ä–æ–º–æ–ª—á–∞–ª
            }
            render();
        }

        function play() {
            if (score > 0) {
                score = score - 1; // –£–º–µ–Ω—å—à–∞–µ–º –ù–ê–°–¢–û–Ø–©–£–Æ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ –ø–∞–º—è—Ç–∏
                
                // –ü—Ä–æ–±—É–µ–º –æ–±–Ω–æ–≤–∏—Ç—å URL (–¥–ª—è –•—Ä–æ–º–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–ª—è –¢–ì ‚Äî –∫–∞–∫ –ø–æ–π–¥–µ—Ç)
                try {
                    var newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?s=' + score;
                    window.history.replaceState({path:newUrl}, '', newUrl);
                } catch(e) { console.log("URL freeze"); }

                render(); // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω
            } else {
                alert("–û—á–∫–∏ –∫–æ–Ω—á–∏–ª–∏—Å—å!");
            }
        }

        function render() {
            // –†–∏—Å—É–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π score
            document.getElementById('sc').textContent = "Score: " + score;
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¢–µ–ª–µ–≥—Ä–∞–º–∞ ‚Äî —ç—Ç–æ –Ω–∞—à –≥–ª–∞–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            tg.MainButton.setText("–°–û–•–†–ê–ù–ò–¢–¨ –†–ï–ö–û–†–î: " + score).show();
        }

        function saveAndExit() {
            // –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç score –±–æ—Ç—É –∏ –ó–ê–ö–†–û–ï–¢ –∏–≥—Ä—É
            tg.sendData(score.toString());
        }
        

        // –°–∞–º—ã–π –≤–∞–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç: –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–≥–æ, —á—Ç–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π score
        tg.onEvent('mainButtonClicked', function() {
            tg.sendData(score.toString());
            tg.close();
        });
    </script>
</head>
<body onload="initGame()" style="text-align:center; background:#1a1a1a; color:white; font-family:sans-serif; padding-top:50px;">
    
    <div style="background:#2c3e50; padding:30px; border-radius:30px; border: 4px solid #34cceb; display:inline-block;">
        <h1 id="sc" style="font-size:50px; margin:0; color:#34cceb;">Score: ?</h1>
    </div>

    <div style="margin-top:40px;">
        <button onclick="play()" style="width:180px; height:180px; border-radius:50%; border:none; background:#34cceb; color:white; font-size:35px; font-weight:bold; box-shadow: 0 8px #2980b9; cursor:pointer; active: transform:translateY(4px);">
            –¢–´–ö!
        </button>
    </div>

    <p style="margin-top:40px; opacity:0.6; font-size:12px;">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ MainButton –∞–∫—Ç–∏–≤–Ω–∞ üöÄ</p>

</body>
</html>
