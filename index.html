<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fly OS Engine</title>
    <script src="https://telegram.org"></script>
    <style>
        body { margin: 0; padding: 0; background: #1a1a1a; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #container { width: 100vw; height: 100vh; position: relative; background: radial-gradient(circle, #27ae60 0%, #1e8449 100%); }
        /* –°—Ç–∏–ª—å –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –Ω–∞—à –¥–≤–∏–∂–æ–∫ */
        .entity-fly { transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); user-select: none; }
    </style>
</head>
<body>
    <div id='container'></div>

    <script>
    // --- CONFIG SECTION (–¢–≤–æ–π —Å—Ç–∏–ª—å) ---
    const Config = {
        style: {
            flySize: "80px",
            fontSize: "55px",
            uiColor: "rgba(255, 255, 255, 0.9)",
            bgPrimary: "#27ae60"
        },
        game: {
            spawnDelay: 300,
            moveInterval: 1200
        }
    };

    // --- CORE ENGINE (–¢–≤–æ—è –ª–æ–≥–∏–∫–∞ add_Object) ---
    const Engine = {
        container: document.getElementById('container'),
        score: 0,

        // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (–∞–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–≤–æ–µ–≥–æ add_Object)
        addObject: function(type, id, content, style) {
            let el = document.createElement(type);
            el.id = id;
            el.className = "entity-" + id.split('_')[0].toLowerCase();
            
            // –ù–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º (—Ç–≤–æ–π –º–µ—Ç–æ–¥ –≤—Ä—É—á–Ω—É—é)
            if (content) {
                let textNode = document.createTextNode(content);
                el.appendChild(textNode);
            }

            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ –∏ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
            Object.assign(el.style, {
                position: "absolute",
                display: "flex",
                alignItems: "center",
                justifyContent: "center",
                cursor: "pointer",
                touchAction: "none"
            }, style);

            this.container.appendChild(el);
            return el;
        },

        updateUI: function() {
            const ui = document.getElementById('UI_Score');
            ui.textContent = "–°—á–µ—Ç: " + this.score;
            window.Telegram.WebApp.MainButton.setText("–°–û–•–†–ê–ù–ò–¢–¨: " + this.score).show();
        }
    };

    // --- GAME LOGIC MODULE ---
    const Game = {
        fly: null,
        
        init: function() {
            // –°–æ–∑–¥–∞–µ–º UI
            Engine.addObject('div', 'UI_Score', '–°—á–µ—Ç: 0', {
                top: '20px', width: '100%', color: Config.style.uiColor,
                fontSize: '30px', fontWeight: 'bold', zIndex: '100', pointerEvents: 'none'
            });

            // –°–æ–∑–¥–∞–µ–º –ú—É—Ö—É —á–µ—Ä–µ–∑ –î–≤–∏–∂–æ–∫
            this.fly = Engine.addObject('div', 'Fly_Target', 'ü™∞', {
                width: Config.style.flySize,
                height: Config.style.flySize,
                fontSize: Config.style.fontSize,
                zIndex: '50'
            });

            // –°–æ–±—ã—Ç–∏—è
            const hitHandler = (e) => {
                e.preventDefault();
                this.onHit();
            };
            this.fly.addEventListener('touchstart', hitHandler);
            this.fly.addEventListener('mousedown', hitHandler);

            // –ó–∞–ø—É—Å–∫ —Ü–∏–∫–ª–æ–≤
            this.relocate();
            setInterval(() => this.relocate(), Config.game.moveInterval);
        },

        relocate: function() {
            const x = Math.floor(Math.random() * (window.innerWidth - 100)) + "px";
            const y = Math.floor(Math.random() * (window.innerHeight - 200)) + 100 + "px";
            this.fly.style.left = x;
            this.fly.style.top = y;
        },

        onHit: function() {
            Engine.score++;
            Engine.updateUI();
            
            // –≠—Ñ—Ñ–µ–∫—Ç "–û–≥–ª—É—à–µ–Ω–∏—è" (–¢–≤–æ—è –∏–¥–µ—è —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è)
            this.fly.textContent = "üòµ‚Äçüí´";
            this.fly.style.transform = "scale(1.5)";
            
            setTimeout(() => {
                this.fly.textContent = "ü™∞";
                this.fly.style.transform = "scale(1)";
                this.relocate();
            }, Config.game.spawnDelay);
        }
    };

    // --- START ---
    window.onload = () => {
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        Game.init();

        tg.onEvent('mainButtonClicked', () => {
            tg.sendData(Engine.score.toString());
            tg.close();
        });
    };
    </script>
</body>
</html>
