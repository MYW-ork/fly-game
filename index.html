<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Весёлый роджер</title>
<!-- Подключаем скрипт Телеграма -->
<script src="https://telegram.org"></script>
<script language="JavaScript">
  var tg = window.Telegram.WebApp;
  tg.expand();
  // Показываем кнопку сохранения рекорда внизу экрана
  tg.MainButton.setText("СОХРАНИТЬ ОЧКИ В БОТЕ").show();

  var score = 777;
  // Попробуем вытащить баланс из ссылки, если бот его передал
  var urlParams = new URLSearchParams(window.location.search);
  if(urlParams.has('score')) score = parseInt(urlParams.get('score'));

  var num_1 = 0, num_2 = 0, num_3 = 0;
  
  function random(min, max) { return Math.floor(min + Math.random() * (max - min + 1)); }

  function addBonus() {
    if((num_1 == num_2) && (num_1 == num_3)) {
        if(num_1 == 0) { alert('Loooser -1000'); score -= 1000; }
        else if(num_1 == 7) { alert('Bingo +7777'); score += 7777; }
        else if(num_1 == 6) { alert('Loooser -666'); score -= 666; }
        else { alert('Bingo +500'); score += 500; }
    } else {
        score -= 1;    
    }
  }

  // ФУНКЦИЯ ОТПРАВКИ ДАННЫХ
  tg.onEvent('mainButtonClicked', function() {
    tg.sendData(score.toString()); // Шлем итоговый счет боту
  });

  function TryyeT() {
    if(score >= 1) {
      num_1 = random(0, 9);
      num_2 = random(0, 9);
      num_3 = random(0, 9);
      addBonus();
      render(); // Рисуем экран заново
    } else {
      alert("Очки кончились!");
    }
  }

  function render() {
    var out = '<p align="center" style="font-size:24px;"><b>Score: ' + score + ' </b></p>';
    out += '<table border="1" width="100%" style="font-size:50px; text-align:center;"><tr>';
    out += '<td>' + num_1 + '</td><td>' + num_2 + '</td><td>' + num_3 + '</td>';
    out += '</tr></table><br>';
    out += '<div align="center"><input type="button" style="padding:20px; width:80%; font-size:20px;" onclick="TryyeT();" value="Крутить!"></div>';
    document.getElementById('container').innerHTML = out;
  }
</script>
</head>
<body onload="render()">
  <div id="container"></div>
</body>
</html>
