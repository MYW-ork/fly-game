<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Весёлый Роджер</title>
<script src="https://telegram.org"></script>
<style>
    body { font-family: sans-serif; background: #f0f0f0; margin: 0; padding: 10px; }
    table { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .num-slot { font-size: 60px; font-weight: bold; background: #eee; padding: 20px; border: 2px solid #ccc; }
    .btn-try { width: 100%; height: 60px; font-size: 20px; background: #34cceb; color: white; border: none; border-radius: 5px; cursor: pointer; }
</style>
</head>
<body onload="init()">
    <div id="game"></div>

    <script>
    var tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.setText("ЗАБРАТЬ ВЫИГРЫШ").show();

    var score = 100; // Стартовые очки (бот потом пришлет актуальные)
    var nums = [0, 0, 0];

    function random(min, max) { return Math.floor(min + Math.random() * (max - min + 1)); }

    function draw() {
        var html = '<p align="center"><b>Твой баланс: ' + score + ' </b></p>';
        html += '<table border="1" width="100%" height="200"><tr>';
        for(var i=0; i<3; i++) {
            html += '<td align="center" class="num-slot">' + nums[i] + '</td>';
        }
        html += '</tr></table><br>';
        html += '<input type="button" class="btn-try" onclick="play();" value="КРУТИТЬ (1 очко)">';
        
        // Таблица выигрышей (мини-версия)
        html += '<br><br><small>777: +7777 | 000: -1000 | 666: -666</small>';
        
        document.getElementById('game').innerHTML = html;
    }

    function play() {
        if(score < 1) { alert("Очки кончились!"); return; }
        
        nums[0] = random(0, 9);
        nums[1] = random(0, 9);
        nums[2] = random(0, 9);

        if (nums[0] == nums[1] && nums[0] == nums[2]) {
            var n = nums[0];
            if (n == 7) score += 7777;
            else if (n == 0) score -= 1000;
            else if (n == 6) score -= 666;
            else if (n == 9) score -= 999;
            else score += (n * 100);
            alert("БОНУС!");
        } else {
            score -= 1;
        }
        draw();
    }

    function init() {
        // Если бот передал баланс через URL (например ?score=500)
        var urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('score')) score = parseInt(urlParams.get('score'));
        draw();
    }

    tg.onEvent('mainButtonClicked', function() {
        tg.sendData(score.toString()); // Отправляем итоговый счет боту
    });
    </script>
</body>
</html>
